
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Kitsune is the platform that powers SuMo">
      
      
      
        <link rel="canonical" href="https://support.mozilla.org/development/">
      
      
        <link rel="prev" href="../patching/">
      
      
        <link rel="next" href="../tests/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.20">
    
    
      
        <title>Development - Kitsune Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#changes-that-involve-new-python-dependencies" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Kitsune Documentation" class="md-header__button md-logo" aria-label="Kitsune Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kitsune Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Development
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mozilla/kitsune" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mozilla/kitsune
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Kitsune Documentation" class="md-nav__button md-logo" aria-label="Kitsune Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Kitsune Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mozilla/kitsune" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mozilla/kitsune
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Join this project!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hacking_howto/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hacking howto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contactus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact us
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer's guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developer's guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conventions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conventions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../patching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Patching Kitsune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Development
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Development
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#changes-that-involve-new-python-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Changes that involve new Python dependencies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changes-that-involve-database-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Changes that involve database migrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Changes that involve database migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Running migrations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-schema-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a schema migration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-data-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a data migration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating a data migration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-migrations-for-data-in-non-kitsune-apps" class="md-nav__link">
    <span class="md-ellipsis">
      Data migrations for data in non-kitsune apps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changes-that-involve-reindexing" class="md-nav__link">
    <span class="md-ellipsis">
      Changes that involve reindexing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Changes that involve reindexing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#things-about-non-trivial-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Things about non-trivial changes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-for-making-the-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow for making the changes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-for-reviewing-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow for reviewing changes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-for-pushing-changes-to-stage" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow for pushing changes to stage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-for-pushing-those-changes-to-production" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow for pushing those changes to production
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#on-the-next-day" class="md-nav__link">
    <span class="md-ellipsis">
      On the next day
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tests/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    All about testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../celery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Celery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../email/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Email from Kitsune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../localization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Localization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../elastic_search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Elastic search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../frontend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Frontend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../svelte/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Svelte
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../browser_permissions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Browser permissions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../zendesk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zendesk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../seo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SEO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../notes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Other Notes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../switching_devices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Switching devices
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SuMo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            SuMo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kitsune Deployments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../k8s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    K8s
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sla/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Service Level Agreement
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../users/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Users
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../questions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ask A Question
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../badges/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Badges
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced-search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced search
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architectural Decisions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Architectural Decisions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architectural-decisions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architectural Decision Records
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0001-record-architecture-decisions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Record
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0002-es-l10n-content/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Search - L10N content
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0003-es-aaq-documents/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Search - AAQ content
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/decisions/0004-type-checking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Type Checking
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#changes-that-involve-new-python-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Changes that involve new Python dependencies
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changes-that-involve-database-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Changes that involve database migrations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Changes that involve database migrations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#running-migrations" class="md-nav__link">
    <span class="md-ellipsis">
      Running migrations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-a-schema-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a schema migration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-data-migration" class="md-nav__link">
    <span class="md-ellipsis">
      Creating a data migration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating a data migration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-migrations-for-data-in-non-kitsune-apps" class="md-nav__link">
    <span class="md-ellipsis">
      Data migrations for data in non-kitsune apps
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changes-that-involve-reindexing" class="md-nav__link">
    <span class="md-ellipsis">
      Changes that involve reindexing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Changes that involve reindexing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#things-about-non-trivial-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Things about non-trivial changes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-for-making-the-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow for making the changes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-for-reviewing-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow for reviewing changes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-for-pushing-changes-to-stage" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow for pushing changes to stage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workflow-for-pushing-those-changes-to-production" class="md-nav__link">
    <span class="md-ellipsis">
      Workflow for pushing those changes to production
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#on-the-next-day" class="md-nav__link">
    <span class="md-ellipsis">
      On the next day
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Development</h1>

<p>This covers loosely how we do big feature changes.</p>
<h2 id="changes-that-involve-new-python-dependencies">Changes that involve new Python dependencies<a class="headerlink" href="#changes-that-involve-new-python-dependencies" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This section of documentation may be outdated.</p>
</div>
<p>All python dependencies have an associated hash (or several) that are
checked at download time. This ensures malicious code doesn't sneak in
through dependencies being hacked, and also makes sure we always get the
exact code we developed against. Changes in dependencies, malicious or
not, will set off red flags and require human intervention.</p>
<p>A pip requirement stanza with hashes looks something like this:</p>
<div class="highlight"><pre><span></span><code>Django==1.8.15 \
    --hash=sha256:e2e41aeb4fb757575021621dc28fceb9ad137879ae0b854067f1726d9a772807 \
    --hash=sha256:863e543ac985d5cfbce09213fa30bc7c802cbdf60d6db8b5f9dab41e1341eacd
</code></pre></div>
<p>hash lines can be repeated, and other comments can be added. The stanza
is delimited by non-comment lines (such as blank lines or other
requirements).</p>
<p>Fortunately we do not need to add or edit those manaully. Using
<a href="https://github.com/peterdemin/pip-compile-multi">pip-compile-multi</a> we
list only our top-level dependencies in
[requirements/*.in]{.title-ref}. To add a dependency, put it in the
appropriate [requirements/*.in]{.title-ref} file, then compile:</p>
<div class="highlight"><pre><span></span><code>pip-compile-multi -g default
</code></pre></div>
<h2 id="changes-that-involve-database-migrations">Changes that involve database migrations<a class="headerlink" href="#changes-that-involve-database-migrations" title="Permanent link">&para;</a></h2>
<p>Any changes to the database (model fields, model field data, adding
permissions, ...) require a migration.</p>
<h3 id="running-migrations">Running migrations<a class="headerlink" href="#running-migrations" title="Permanent link">&para;</a></h3>
<p>To run migrations, you do:</p>
<div class="highlight"><pre><span></span><code>$ ./manage.py migrate
</code></pre></div>
<p>It will perform any migrations that haven't been performed for all apps.</p>
<h3 id="creating-a-schema-migration">Creating a schema migration<a class="headerlink" href="#creating-a-schema-migration" title="Permanent link">&para;</a></h3>
<p>To create a new migration the automatic way:</p>
<ol>
<li>
<p>make your model changes</p>
</li>
<li>
<p>run:</p>
<div class="highlight"><pre><span></span><code>./manage.py makemigrations &lt;app&gt;
</code></pre></div>
<p>where <code>&lt;app&gt;</code> is the app name (sumo, wiki, questions, ...).</p>
</li>
<li>
<p>run the migration on your machine:</p>
<div class="highlight"><pre><span></span><code>./manage.py migrate
</code></pre></div>
</li>
<li>
<p>run the tests to make sure everything works</p>
</li>
<li>
<p>add the new migration files to git</p>
</li>
<li>
<p>commit</p>
</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><a href="https://docs.djangoproject.com/en/stable/topics/migrations/#adding-migrations-to-apps">Django documentation: Adding migrations to apps</a></p>
</div>
<h2 id="creating-a-data-migration">Creating a data migration<a class="headerlink" href="#creating-a-data-migration" title="Permanent link">&para;</a></h2>
<p>Creating data migrations is pretty straight-forward in most cases.</p>
<p>To create a data migration the automatic way:</p>
<ol>
<li>
<p>run:</p>
<div class="highlight"><pre><span></span><code>./manage.py makemigrations --empty &lt;app&gt;
</code></pre></div>
<p>where <code>&lt;app&gt;</code> is the app name (sumo, wiki, questions, ...).</p>
</li>
<li>
<p>edit the data migration you just created to do what you need it to
    do</p>
</li>
<li>
<p>make sure to add [reverse_code]{.title-ref} arguments to all
    [RunPython]{.title-ref} operations which undoes the changes</p>
</li>
<li>
<p>add a module-level docstring explaining what this migration is doing</p>
</li>
<li>
<p>run the migration forwards and backwards to make sure it works
    correctly</p>
</li>
<li>
<p>add the new migration file to git</p>
</li>
<li>
<p>commit</p>
</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><a href="https://docs.djangoproject.com/en/stable/topics/migrations/#data-migrations">Django documentation: Data Migrations</a></p>
</div>
<h3 id="data-migrations-for-data-in-non-kitsune-apps">Data migrations for data in non-kitsune apps<a class="headerlink" href="#data-migrations-for-data-in-non-kitsune-apps" title="Permanent link">&para;</a></h3>
<p>If you're doing a data migration that adds data to an app that's not
part of kitsune, but is instead a library (e.g. django-waffle), then
create the data migration in the sumo app and add a dependency to the
latest migration in the library app.</p>
<p>For example, this adds a dependency to django-waffle's initial
migration:</p>
<div class="highlight"><pre><span></span><code>class Migration(migrations.Migration):

    dependencies = [
        ...
        (&#39;waffle&#39;, &#39;0001_initial&#39;),
        ...
    ]
</code></pre></div>
<h2 id="changes-that-involve-reindexing">Changes that involve reindexing<a class="headerlink" href="#changes-that-involve-reindexing" title="Permanent link">&para;</a></h2>
<p>With Elastic Search, it takes a while to reindex. We need to be able to
reindex without taking down search.</p>
<p>This walks through the workflow for making changes to our Elastic Search
code that require reindexing.</p>
<h3 id="things-about-non-trivial-changes">Things about non-trivial changes<a class="headerlink" href="#things-about-non-trivial-changes" title="Permanent link">&para;</a></h3>
<ol>
<li>We should roll multiple reindex-requiring changes into megapacks
    when it makes sense and does not add complexity.</li>
<li>Developers should test changes with recent sumo dumps.</li>
</ol>
<h3 id="workflow-for-making-the-changes">Workflow for making the changes<a class="headerlink" href="#workflow-for-making-the-changes" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>work on the changes in a separate branch (just like everything else
    we do)</p>
</li>
<li>
<p>make a pull request</p>
</li>
<li>
<p>get the pull request reviewed</p>
</li>
<li>
<p>rebase the changes so they're in two commits:</p>
<ol>
<li>a stage 1 commit that changes <code>ES_WRITE_INDEXES</code>, updates the
    mappings and updates the indexing code</li>
<li>a stage 2 commit that changes <code>ES_INDEXES</code>, changes
    <code>ES_WRITE_INDEXES</code>, and changes the search view code</li>
</ol>
<p><strong>Avoid cosmetic changes that don't need to be made (e.g. pep-8
fixes, etc.)</strong></p>
</li>
<li>
<p>push those changes to the same pull request</p>
</li>
<li>
<p>get those two changes reviewed</p>
</li>
</ol>
<p>Once that's ok, then that branch should get updated from main, then
pushed to stage to get tested.</p>
<p>That branch should <strong>not</strong> land in main, yet.</p>
<h3 id="workflow-for-reviewing-changes">Workflow for reviewing changes<a class="headerlink" href="#workflow-for-reviewing-changes" title="Permanent link">&para;</a></h3>
<p>Go through and do a normal review.</p>
<p>After everything looks good, the developer should rebase the changes so
they\'re in a stage 1 commit and a stage 2 commit.</p>
<p>At that point:</p>
<ol>
<li>Verify each commit individually. Make sure the code is correct. Make
    sure the tests pass. Make sure the site is functional.</li>
<li>Verify that the <code>ES_INDEXES</code> and <code>ES_WRITE_INDEXES</code> settings have
    the correct values in each commit.</li>
</ol>
<h3 id="workflow-for-pushing-changes-to-stage">Workflow for pushing changes to stage<a class="headerlink" href="#workflow-for-pushing-changes-to-stage" title="Permanent link">&para;</a></h3>
<p>Don't land the changes in main, yet!</p>
<p>If you hit problems, deploy the main branch back to the stage server and
go back to coding/fixing.</p>
<ol>
<li>Push the branch you have your changes in to the official
    mozilla/kitsune remote.</li>
<li>Deploy the stage 1 commit to stage.</li>
<li>Verify that search still works.</li>
<li>Verify that the index settings are correct---look at the
    <code>ES_INDEXES</code> and <code>ES_WRITE_INDEXES</code> values.</li>
<li>Destructively reindex.</li>
<li>Deploy the stage 2 commit to stage.</li>
<li>Verify that search still works.</li>
<li>Verify that the index settings are correct---look at the
    <code>ES_INDEXES</code> and <code>ES_WRITE_INDEXES</code> values.</li>
<li>Verify bugs that were fixed with the new search code.</li>
</ol>
<h3 id="workflow-for-pushing-those-changes-to-production">Workflow for pushing those changes to production<a class="headerlink" href="#workflow-for-pushing-those-changes-to-production" title="Permanent link">&para;</a></h3>
<p>If we're also doing a production push, first push next to production
and verify that everything is fine. Then continue.</p>
<ol>
<li>Tell the other sumo devs to hold off on pushing to main branch and
    deploying. Preferably by email and IRC.</li>
<li>Once you\'ve told everyone, land the changes in main.</li>
<li>Deploy the stage 1 commit to production.</li>
<li>Verify that search works.</li>
<li>Destructively reindex to the new write index.</li>
<li>When reindexing is done, push the stage 2 commit to production.</li>
<li>Verify that search works.</li>
<li>Verify bugs that were fixed with the new search code.</li>
</ol>
<p>Pretty sure this process allows us to back out at any time with minimal
downtime.</p>
<h3 id="on-the-next-day">On the next day<a class="headerlink" href="#on-the-next-day" title="Permanent link">&para;</a></h3>
<p>If everything is still fine, then merge the special branch into main and
delete the old read index.</p>
<p>Announce "STUCK THE LANDING!" after a successful mapping change
deployment.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.top", "toc.follow", "content.code.copy", "content.code.highlight"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.dd8806f2.min.js"></script>
      
    
  </body>
</html>